{x2;if:!$userhash}{x2;include:header}<body>{x2;include:nav}<div class="container-fluid">	<div class="row-fluid">		<div class="main">			<div class="col-xs-2 leftmenu">				{x2;include:menu}			</div>			<div id="datacontent">				{x2;endif}				<div class="box itembox" style="margin-bottom:0px;border-bottom:1px solid #CCCCCC;">					<div class="col-xs-12">						<ol class="breadcrumb">							<li><a href="index.php?{x2;$_app}-master">{x2;$apps[$_app]['appname']}</a></li>							<li><a href="index.php?{x2;$_app}-master-survey">问卷调查</a></li>							<li class="active">问卷内容</li>						</ol>					</div>				</div>				{x2;if:$nodes}				<div class="box itembox" style="padding-top:10px;margin-bottom:0px;">					<h4 class="title" style="padding:10px;">						问卷统计						<span class="pull-right">							<a class="btn btn-primary ajax" href="index.php?{x2;$_app}-master-survey-downloadstats&svyid={x2;$survey['svyid']}{x2;$u}">下载（xlsx）</a>						</span>					</h4>					{x2;tree:$nodes,node,nid}					<blockquote style="background-color:#f3f3f3;font-size:14px;border-left:5px solid #02756e;">						{x2;v:node['synetitle']}					</blockquote>					{x2;tree:$questions[v:node['syneid']],question,qid}					{x2;if:$questypes[v:question['syqnquestiontype']]['questsort']}					<table class="table table-hover table-bordered">						<thead>						<tr class="info">							<th colspan="2">第{x2;v:qid}题</th>						</tr>						</thead>						<tbody>						<tr>							<td>								{x2;realhtml:v:question['syqnquestion']}							</td>							<td width="120" class="text-center">								<a class="btn selfmodal" href="javascript:;" data-target="#modal" url="index.php?{x2;$_app}-master-survey-answers&svyid={x2;$survey['svyid']}&syqnid={x2;v:question['syqnid']}">查看详细</a>							</td>						</tr>						</tbody>					</table>					{x2;else}					<table class="table table-hover table-bordered">						<thead>							<tr class="info">								<th colspan="2">第{x2;v:qid}题</th>							</tr>						</thead>						<tbody>						<tr>							<td width="80">								题干							</td>							<td>								{x2;realhtml:v:question['syqnquestion']}							</td>						</tr>						<tr>							<td>								选项							</td>							<td>								{x2;realhtml:v:question['syqnquestionselect']}							</td>						</tr>						<tr>							<td>								统计							</td>							<td class="statsbox">								<div class="statstable">									<table class="table table-hover table-bordered text-center">										<thead>										<tr class="info">											<th width="180" class="text-center">选项</th>											<th width="120" class="text-center">选择数</th>											<th colspan="2" class="text-center">占比</th>										</tr>										</thead>										<tbody>											{x2;eval: v:datax = array()}											{x2;eval: v:datay = array()}											{x2;tree:$selectors,so,sid}											{x2;if:v:key == v:question['syqnquestionselectnumber']}											{x2;eval: break;}											{x2;endif}											<tr>												{x2;eval: v:datax[] = v:so}												{x2;eval: v:datay[] = intval($qnumber[v:question['syqnid']][v:so])}												<td>{x2;v:so}</td>												<td>{x2;eval: echo intval($qnumber[v:question['syqnid']][v:so])}</td>												<td width="120" style="border-right: 0px;">													{x2;eval: echo intval($rate[v:question['syqnid']][v:so])} %												</td>												<td>													<div class="progress">														<div class="progress-bar" role="progressbar" aria-valuenow="{x2;$rate[v:question['syqnid']][v:so]}" aria-valuemin="0" aria-valuemax="100" style="width: {x2;$rate[v:question['syqnid']][v:so]}%;">														</div>													</div>												</td>											</tr>											{x2;endtree}											<tr>												<td>有效填写人数</td>												<td>{x2;$number[v:question['syqnid']]}</td>												<td colspan="2"></td>											</tr>										</tbody>									</table>								</div>								<div class="statschart hide" data-x="{x2;eval: echo urlencode(json_encode(v:datax))}" data-y="{x2;eval: echo urlencode(json_encode(v:datay))}"></div>								<ul class="list-unstyled list-inline text-right">									<li>										<a class="btn btn-default btn-primary chartsbtn tablebtn">表格</a>									</li>									<li>										<a class="btn btn-default barbtn chartsbtn" data-type="bar">柱形图</a>									</li>									<li>										<a class="btn btn-default linebtn chartsbtn" data-type="line">折线图</a>									</li>									<li>										<a class="btn btn-default piebtn chartsbtn" data-type="pie">饼图</a>									</li>								</ul>							</td>						</tr>						</tbody>					</table>					{x2;endif}					{x2;endtree}					{x2;endtree}				</div>				{x2;else}				<div class="box itembox" style="padding-top:10px;margin-bottom:0px;">					<h4 class="title" style="padding:10px;">						问卷内容						<span class="pull-right">							<a class="btn btn-primary" href="index.php?{x2;$_app}-master-survey-addnode&svyid={x2;$survey['svyid']}{x2;$u}">添加节点</a>						</span>					</h4>				</div>				{x2;endif}			</div>			{x2;if:!$userhash}		</div>	</div></div><div id="modal" class="modal fade">	<div class="modal-dialog">		<div class="modal-content">			<div class="modal-header">				<button aria-hidden="true" class="close" type="button" data-dismiss="modal">×</button>				<h4 id="myModalLabel">					答案详情				</h4>			</div>			<div class="modal-body" id="modal-body"></div>			<div class="modal-footer">				<button aria-hidden="true" class="btn btn-primary" data-dismiss="modal">关闭</button>			</div>		</div>	</div></div><script src="files/public/js/echarts/echarts.min.js"></script><script>	$(function(){		$(".chartsbtn").on("click",function(){			var that = this;			var parent = $(that).parents(".statsbox").first();			var ul = $(that).parents("ul").first();			var tablebox = parent.children(".statstable").first();			var chartbox = parent.children(".statschart").first();			var chartdiv = $('<div style="width: 100%;height:400px;"></div>');			ul.find(".chartsbtn").removeClass("btn-primary");			$(that).addClass("btn-primary");			if($(that).hasClass("tablebtn"))			{				tablebox.removeClass("hide");				chartbox.addClass("hide");			}			else			{				tablebox.addClass("hide");				chartbox.removeClass("hide");				chartbox.html('');				chartdiv.appendTo(chartbox);				var datax = JSON.parse(decodeURIComponent(chartbox.attr("data-x")));				var datay = JSON.parse(decodeURIComponent(chartbox.attr("data-y")));				if($(that).data('type') == 'pie')				{					var jdatay = [];					for(x in datay)					{						jdatay.push({name:datax[x],value:datay[x],allnumber:113});					}					var option = {						tooltip: {							trigger: 'item',							formatter: function (params) {								var title = '<h4 style="line-height: 2">'+params.name+'</h4>';								var num = '<p>数值：'+params.value.toString()+'</p>';								var t1 = '<p>占比：'+params.percent.toString()+'%</p>';								return title + num + t1;							}						},						series: [{							type: 'pie',							data: jdatay,							emphasis: {								itemStyle: {									shadowBlur: 10,									shadowOffsetX: 0,									shadowColor: 'rgba(0, 0, 0, 0.5)'								}							}						}]					};				}				else				{					var option = {						tooltip: {							trigger: 'item'						},						xAxis: {							type: 'category',							data: datax						},						yAxis: {							type: 'value'						},						series: [{							type: $(that).data('type'),							data: datay						}]					};				}				echarts.init(chartdiv[0]).setOption(option);			}		});	});</script>{x2;include:footer}</body></html>{x2;endif}